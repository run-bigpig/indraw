# 更新日志

本文档记录了 Indraw Editor 的所有重要更新和变更。

## [1.1.1] - 2025-01-XX

### ✨ 新增功能

#### 图库功能
- **图片图库**：新增图库功能，方便管理和重用导出的图片
  - 在工具栏添加图库按钮（Images 图标），位于上传按钮下方
  - 自动读取导出目录中的所有图片文件（支持 PNG、JPG、JPEG、WebP、GIF、BMP、SVG 格式）
  - 图片列表按修改时间倒序排列（最新的在前）
  - 显示图片缩略图、文件名、大小和修改时间
  - 支持刷新图片列表
  - 悬停显示操作按钮（查看、导入）
  - 点击"查看"按钮可放大预览图片
  - 点击"导入"按钮将图片导入到当前画布
  - 预览模态框中也可直接导入图片
  - 完整的国际化支持（中文/英文）

#### 后端 API 增强
- **文件服务扩展**：新增图片文件管理 API
  - `ListImagesInDirectory`: 列出指定目录中的所有图片文件
  - `ReadImageFile`: 读取图片文件并返回 base64 编码数据
  - 支持多种图片格式识别和 MIME 类型处理

### 🔧 优化改进

#### 性能优化
- **图库加载优化**：优化图库模态框的加载性能
  - 模态框立即显示，图片列表异步加载，避免卡顿
  - 图片预览懒加载，按需加载缩略图
  - 预加载前 10 张图片的预览，提升用户体验

#### 用户体验改进
- **交互优化**：改进图库的交互体验
  - 移除卡片点击导入功能，只能通过按钮触发，避免误操作
  - 悬停时显示操作按钮，界面更清晰
  - 预览模态框支持全屏查看大图
  - 优化按钮样式和布局

### 🐛 Bug 修复

- **修复重复导入问题**：修复点击导入按钮时触发两次导入的问题
  - 添加事件冒泡阻止，确保按钮点击不会触发父元素事件
- **修复依赖循环问题**：修复图库组件中的无限更新循环
  - 优化 useEffect 依赖项，避免不必要的重新渲染
  - 重构加载逻辑，消除依赖循环

---

## [1.0.4] - 2025-12-10

## 更新内容

### Bug Fixes
- **修复 Git 命令执行问题**：修复了更新检查服务调用 git 命令导致终端窗口闪现的问题
  - 切换到无 token 模式访问 GitHub API
  - 移除了会执行 git 命令的 gitconfig 库依赖
  - 改进了更新服务初始化逻辑，避免执行外部命令
  - 改进了更新服务初始化失败时的错误处理

### Improvements
- **增强更新日志显示**：改进了设置面板中的更新日志显示
  - 集成 react-markdown 库，支持完整的 Markdown 语法
  - 为更新日志添加固定高度（200px）和滚动功能
  - 使用自定义样式组件增强 Markdown 渲染
  - 支持所有标准 Markdown 功能（标题、列表、代码块、链接等）
  - 使用与主题一致的样式优化视觉效果

更新日志已添加，格式与之前的版本保持一致。

---

## [1.0.3] - 2025-12-09

### ✨ 新增功能

#### 更新与版本管理
- **更新检查服务**：集成应用更新检查功能
  - 从 GitHub Releases 自动检测新版本
  - 在设置面板中显示版本信息
  - 更新通知和下载支持
  - 更新相关消息的本地化支持

#### AI 服务增强
- **服务可用性检测**：实现 AI 提供商服务可用性检查
  - 实时检查 Gemini、OpenAI 和云端提供商的状态
  - 更好的错误消息和用户反馈
  - 在设置面板中显示可用性状态

#### 导出功能
- **导出选项弹窗**：添加全面的导出选项对话框
  - 自定义导出格式选择（PNG、JPG 等）
  - 质量和分辨率设置
  - 默认导出目录配置（图片文件夹）
  - 增强的图像导出功能，提供更多选项

#### 文件服务与自动保存
- **事件驱动自动保存**：实现基于事件的自动保存机制
  - 使用事件监听器的异步保存操作
  - 优化保存性能，减少不必要的操作
  - 实时保存状态反馈
  - 通过避免频繁保存导致的卡顿来改善用户体验
- **保存请求合并**：通过请求合并优化保存操作
  - 队列机制高效处理多个保存请求
  - 直接 JSON 字符串写入，避免不必要的序列化
  - 变更检测，跳过数据未更改时的保存
- **模型下载进度**：添加模型下载进度追踪
  - 实时显示下载进度
  - 基于事件的下载通知
  - 更好的下载状态反馈

#### 用户界面
- **增强的确认对话框**：改进确认对话框功能
  - 为未保存的更改添加"放弃更改"选项
  - 增强的本地化支持（中文和英文）
  - 关闭设置时未保存更改的更好用户体验

---

## [1.0.2] - 2025-12-08

### ✨ 新增功能

#### AI 服务增强
- **云端认证令牌支持**：添加云端认证令牌支持
  - 在设置中加密存储令牌
  - 基于令牌的云端 AI 服务认证
  - 增强安全性和灵活性

#### 绘图工具
- **修复笔刷模式**：引入修复笔刷工具用于图像修复
  - 基于 OpenCV 的图像修复功能
  - 智能图像修复能力
  - 与绘图工具集成

### 🔧 优化改进

- **保存性能**：进一步优化文件保存操作
  - 请求合并机制
  - 改进的保存队列处理
  - 减少资源占用

---

## [1.0.1] - 2025-12-05

### ✨ 新增功能

#### AI 提供商扩展
- **CloudProvider 实现**：添加 CloudProvider AI 服务提供商
  - 可配置的云端端点 URL
  - 支持基于云端的 AI 服务
  - 通过云端 API 进行图像生成、编辑和提示词增强
  - 多图像编辑支持

#### OpenAI 功能增强
- **流式支持**：为 OpenAI 模型添加流式支持
  - 文本模型的流式响应
  - 图像模型的流式处理
  - 通过第三方中继服务进行实时响应处理
  - 提升响应速度和用户体验
- **双图像生成模式**：增强 OpenAI 提供商的双模式
  - 图像 API 模式（DALL-E、GPT Image 1）
  - 聊天模式（多模态模型）
  - 用户可选择的图像生成模式
  - 灵活的 API 端点配置

#### 画布性能
- **绘制性能优化**：优化画布绘制性能
  - 直接操作 Konva 节点进行笔刷操作
  - 提升绘制流畅度
  - 优化工具处理逻辑
  - 减少渲染延迟
  - 使用 Canny 边缘检测的智能提取
  - 形态学操作以改善图像处理

### 🔧 优化改进

- **依赖管理**：清理未使用的包文件
- **依赖更新**：更新项目依赖到最新版本
- **图像处理**：通过缓存机制增强智能提取
- **实时预览**：为图像切片添加防抖预览

---

## [1.0.0] - 2025-12-04

### 🎉 首个正式版本

这是 Indraw Editor 的第一个正式版本，提供全面的 AI 驱动图像编辑平台。

### ✨ 核心功能

#### AI 能力
- **多 AI 提供商**：支持 Google Gemini 和 OpenAI
  - 基于提供商的架构，易于扩展
  - 可配置的 API 密钥和端点
  - 服务可用性检查
- **AI 图像生成**：从文本提示词生成图像
  - 支持参考图像
  - 草图图像支持，用于风格迁移
  - 提示词增强能力
- **AI 图像编辑**：使用 AI 辅助编辑图像
  - 使用提示词进行图像变换
  - 使用自定义样式的多图像融合
  - 使用 RMBG-1.4 模型进行背景移除
- **提示词管理**：全面的提示词库系统
  - 从 JSON 远程获取提示词库
  - 搜索和分类筛选
  - 风格生成和草图还原提示词
  - 快速应用提示词支持

#### 画布与绘图工具
- **高级画布系统**：使用 Konva 的专业级画布
  - 通过直接节点操作实现高性能渲染
  - 使用 requestAnimationFrame 进行实时绘制
  - 优化的笔刷和橡皮擦工具
  - 专用绘制图层以实现流畅性能
- **形状绘制工具**：全面的形状创建能力
  - 多边形、星形、圆角矩形、椭圆形状
  - 箭头、扇形、环形和弧形形状
  - 形状属性管理
  - 渐变和样式自定义
- **绘图模式**：多种绘图模式
  - 普通笔刷模式
  - AI 辅助笔刷模式
  - 修复笔刷模式（基于 OpenCV）
  - 支持透明度的橡皮擦工具

#### 图层管理
- **专业图层系统**：功能齐全的图层管理
  - 多种图层类型（图像、文本、形状、笔刷、组）
  - 图层分组和取消分组
  - 基于类型和上下文的动态图层命名
  - 图层可见性和透明度控制
  - 通过拖放重新排序图层
- **历史系统**：完整的撤销/重做功能
  - 带操作描述的历史面板
  - 所有操作的时间戳追踪
  - 历史导航能力
  - 使用空闲回调优化的历史管理

#### 文本与排版
- **文本编辑**：丰富的文本编辑能力
  - 字体族选择
  - 字体大小、颜色和样式自定义
  - 文本对齐选项
  - 动态文本图层属性

#### 图像处理
- **图像操作**：全面的图像处理
  - 带模态界面的图像裁剪
  - 批量图像切片功能
  - 图像合成和布局
  - 带边缘检测的智能提取
  - 使用 RMBG 模型进行背景移除
- **模型管理**：AI 模型文件管理
  - 基于 HTTP 的模型文件服务器
  - 模型下载和状态检查
  - Transformers.js 集成，带 OpenCV 回退
  - 设置中的模型配置

#### 文件管理
- **项目系统**：完整的项目管理
  - 保存和加载项目文件
  - 事件驱动的自动保存机制
  - 项目路径管理
  - 临时项目支持
- **导出功能**：多种导出选项
  - 各种格式的图像导出
  - 自定义质量和分辨率设置
  - 默认导出目录配置
- **文件操作**：增强的文件处理
  - 拖放图像上传
  - 文件类型验证
  - 操作期间的视觉反馈
  - 加载图像的自动画布适配

#### 用户界面
- **现代化设计**：简洁直观的界面
  - 具有现代美学的深色主题
  - 带面板的响应式布局
  - 带工具选择的工具栏
  - 用于图层编辑的属性面板
  - 用于配置的设置面板
- **国际化**：完整的 i18n 支持
  - 中文（简体）和英文界面
  - 语言切换器组件
  - 全面的本地化覆盖
- **用户体验**：增强的可用性
  - 带放弃选项的确认对话框
  - 全屏加载覆盖层
  - 操作进度指示器
  - 键盘快捷键支持

#### CI/CD 与构建系统
- **自动化发布**：GitHub Actions 工作流
  - 多架构构建（Windows、Linux、macOS）
  - 在版本标签上自动构建和发布
  - 跨平台构建产物处理
  - 特定架构构建（macOS 的 amd64、arm64）
- **构建配置**：优化的构建设置
  - 用于快速构建的 Vite 配置
  - 适当的 .gitignore 用于构建产物
  - Windows 应用图标
  - 特定平台的构建配置

### 🔧 性能优化

- **画布性能**：使用 Konva 原生 API 优化绘制
  - 直接节点操作用于笔刷/橡皮擦工具
  - requestAnimationFrame 用于流畅更新
  - requestIdleCallback 用于非阻塞操作
  - React.memo 和 useMemo 优化
  - 节流回调用于性能控制
- **保存操作**：优化文件操作
  - 防抖自动保存以减少 I/O 开销
  - 多个保存的请求合并
  - 变更检测以跳过不必要的保存
  - 队列机制用于高效保存处理
- **图像处理**：增强图像操作
  - 并行图像加载
  - 背景移除的缓存机制
  - 使用优化算法的智能提取
  - 图像切片的防抖预览

### 🔧 代码质量

- **架构**：结构良好的代码库
  - 基于提供商的 AI 服务架构
  - 集中的类型定义
  - 模块化组件结构
  - 清晰的关注点分离
- **重构**：代码改进
  - AI 提供商接口重构
  - 设置上下文重构以支持 Hooks
  - 移除调试日志和不必要的代码
  - 改进的错误处理

### 🐛 问题修复

- **CI 配置**：修复 Ubuntu 兼容性
  - 用于 webkit2gtk-4.0 兼容性的 pkg-config 别名
  - 更新 webkit2gtk 包名
- **类型定义**：修复注释格式
- **本地化**：改进消息清晰度

---

## 更新说明

### 版本号规则
- **主版本号**：重大功能更新或架构变更
- **次版本号**：新增功能或重要改进
- **修订版本号**：问题修复和小幅优化

### 更新类型说明
- ✨ **新增功能**：新添加的功能特性
- 🔧 **优化改进**：性能优化、用户体验改进等
- 🐛 **问题修复**：Bug 修复和问题解决
- 📝 **文档更新**：文档和注释的更新
- 🔄 **重构**：代码重构和架构调整

---

**注意**：本文档会持续更新，记录所有重要的变更。建议定期查看以了解最新功能和改进。

